<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>Nouveau Produit</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="resetForm()" fill="clear">
        <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="add-circle-outline" color="primary"></ion-icon>
        Ajouter un nouveau produit
      </ion-card-title>
    </ion-card-header>
    
    <ion-card-content>
      <form (ngSubmit)="onSubmit()">
        <ion-grid>
          <ion-row>
            <!-- Nom du produit -->
            <ion-col size="12" size-md="6">
              <ion-item>
                <ion-label position="stacked">
                  Nom du produit <ion-text color="danger">*</ion-text>
                </ion-label>
                <ion-input 
                  type="text" 
                  placeholder="Ex: Pommes Golden"
                  [(ngModel)]="product.name"
                  name="name"
                  required>
                </ion-input>
              </ion-item>
            </ion-col>

            <!-- Catégorie -->
            <ion-col size="12" size-md="6">
              <ion-item>
                <ion-label position="stacked">
                  Catégorie <ion-text color="danger">*</ion-text>
                </ion-label>
                <ion-select 
                  placeholder="Sélectionner une catégorie"
                  [(ngModel)]="product.category"
                  name="category"
                  interface="action-sheet"
                  required>
                  <ion-select-option *ngFor="let category of categories" [value]="category">
                    {{category}}
                  </ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>
          </ion-row>

          <ion-row>
            <!-- Prix -->
            <ion-col size="12" size-md="6">
              <ion-item>
                <ion-label position="stacked">
                  Prix unitaire (€) <ion-text color="danger">*</ion-text>
                </ion-label>
                <ion-input 
                  type="number" 
                  placeholder="0.00"
                  [(ngModel)]="product.price"
                  name="price"
                  min="0.01"
                  step="0.01"
                  required>
                </ion-input>
              </ion-item>
            </ion-col>

            <!-- Quantité initiale -->
            <ion-col size="12" size-md="6">
              <ion-item>
                <ion-label position="stacked">
                  Quantité initiale
                </ion-label>
                <ion-input 
                  type="number" 
                  placeholder="0"
                  [(ngModel)]="product.quantity"
                  name="quantity"
                  min="0"
                  step="1"
                  (ionChange)="onQuantityChange()">
                </ion-input>
              </ion-item>
            </ion-col>
          </ion-row>

          <ion-row>
            <!-- Stock minimum -->
            <ion-col size="12" size-md="6">
              <ion-item>
                <ion-label position="stacked">
                  Stock minimum <ion-text color="danger">*</ion-text>
                </ion-label>
                <ion-input 
                  type="number" 
                  placeholder="0"
                  [(ngModel)]="product.minStock"
                  name="minStock"
                  min="0"
                  step="1"
                  (ionChange)="onMinStockChange()"
                  required>
                </ion-input>
              </ion-item>
            </ion-col>

            <!-- Fournisseur -->
            <ion-col size="12" size-md="6">
              <ion-item>
                <ion-label position="stacked">
                  Fournisseur <ion-text color="danger">*</ion-text>
                </ion-label>
                <ion-select 
                  placeholder="Sélectionner un fournisseur"
                  [(ngModel)]="product.supplier"
                  name="supplier"
                  interface="action-sheet"
                  required>
                  <ion-select-option *ngFor="let supplier of suppliers" [value]="supplier">
                    {{supplier}}
                  </ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>
          </ion-row>

          <!-- Statut (lecture seule) -->
          <ion-row>
            <ion-col size="12">
              <ion-item>
                <ion-label position="stacked">Statut du stock</ion-label>
                <ion-input 
                  [value]="getStatusText(product.status)" 
                  readonly
                  [class]="'status-' + product.status">
                </ion-input>
              </ion-item>
              <div class="status-help">
                <small>
                  Le statut est calculé automatiquement en fonction de la quantité et du stock minimum.
                </small>
              </div>
            </ion-col>
          </ion-row>

          <!-- Boutons d'action -->
          <ion-row>
            <ion-col size="12" class="ion-text-center ion-margin-top">
              <ion-button 
                type="submit" 
                color="primary" 
                size="large"
                [disabled]="isLoading"
                class="submit-button">
                <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
                <ion-icon *ngIf="!isLoading" name="save-outline" slot="start"></ion-icon>
                {{ isLoading ? 'Ajout en cours...' : 'Ajouter le produit' }}
              </ion-button>
              
              <ion-button 
                type="button" 
                color="medium" 
                fill="outline"
                size="large"
                [disabled]="isLoading"
                (click)="resetForm()"
                class="reset-button">
                <ion-icon name="refresh-outline" slot="start"></ion-icon>
                Réinitialiser
              </ion-button>
            </ion-col>
          </ion-row>
        </ion-grid>
      </form>
    </ion-card-content>
  </ion-card>

  <!-- Aperçu du produit -->
  <ion-card *ngIf="product.name" class="preview-card">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="eye-outline" color="secondary"></ion-icon>
        Aperçu du produit
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6"><strong>Nom:</strong></ion-col>
          <ion-col size="6">{{product.name || 'Non spécifié'}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6"><strong>Catégorie:</strong></ion-col>
          <ion-col size="6">{{product.category || 'Non spécifié'}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6"><strong>Prix:</strong></ion-col>
          <ion-col size="6">{{product.price || 0 | currency:'EUR':'symbol':'1.2-2'}}</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6"><strong>Quantité:</strong></ion-col>
          <ion-col size="6">{{product.quantity || 0}} unités</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6"><strong>Stock minimum:</strong></ion-col>
          <ion-col size="6">{{product.minStock || 0}} unités</ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="6"><strong>Statut:</strong></ion-col>
          <ion-col size="6">
            <ion-badge [color]="getStatusColor(product.status)">
              {{getStatusText(product.status)}}
            </ion-badge>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-card-content>
  </ion-card>
</ion-content>

<!-- Alert pour les messages -->
<ion-alert
  [isOpen]="showAlert"
  [header]="alertHeader"
  [message]="alertMessage"
  [buttons]="['OK']"
  (didDismiss)="onAlertDismiss()">
</ion-alert>