<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
      <ion-button (click)="retourStock()">
        <ion-icon name="arrow-back-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Modifier le Produit</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="annuler()" color="medium">
        Annuler
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Chargement du produit...</p>
  </div>

  <!-- Formulaire de modification -->
  <div *ngIf="!isLoading" class="edit-form">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Modifier {{produit.name}}</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <form (ngSubmit)="onSubmit()" #productForm="ngForm">
          <ion-grid>
            <ion-row>
              <ion-col size="12" size-md="6">
                <!-- Nom du produit -->
                <ion-item>
                  <ion-label position="stacked">Nom du produit *</ion-label>
                  <ion-input 
                    [(ngModel)]="produit.name" 
                    name="name"
                    type="text" 
                    placeholder="Entrez le nom du produit"
                    required
                    autocomplete="off">
                  </ion-input>
                </ion-item>

                <!-- Prix -->
                <ion-item>
                  <ion-label position="stacked">Prix unitaire (€) *</ion-label>
                  <ion-input 
                    [(ngModel)]="produit.price" 
                    name="price"
                    type="number" 
                    min="0.01"
                    step="0.01"
                    placeholder="0.00"
                    required
                    autocomplete="off">
                  </ion-input>
                </ion-item>

                <!-- Quantité -->
                <ion-item>
                  <ion-label position="stacked">Quantité en stock *</ion-label>
                  <ion-input 
                    [(ngModel)]="produit.quantity" 
                    name="quantity"
                    type="number" 
                    min="0"
                    step="1"
                    placeholder="0"
                    required
                    autocomplete="off">
                  </ion-input>
                </ion-item>
              </ion-col>

              <ion-col size="12" size-md="6">
                <!-- Catégorie -->
                 <ion-item>
                  <ion-label position="stacked">Catégorie</ion-label>
                  <ion-select 
                    [(ngModel)]="produit.categorie" 
                    name="categorie" 
                    placeholder="Sélectionnez une catégorie"
                    interface="action-sheet">
                    <ion-select-option value="">Aucune catégorie</ion-select-option>
                    <ion-select-option *ngFor="let cat of categories" [value]="cat">
                      {{cat}}
                    </ion-select-option>
                  </ion-select>
                </ion-item>



                <!-- Notes du formulaire -->
                <div class="form-notes">
                  <p><small>* Champs obligatoires</small></p>
                  <p><small>Quantité: 0 = rupture de stock</small></p>
                </div>
              </ion-col>
            </ion-row>
          </ion-grid>

          <!-- Boutons d'action -->
          <div class="action-buttons">
            <ion-button 
              type="submit" 
              expand="block" 
              color="primary"
              [disabled]="isSaving || !productForm.form.valid">
              <ion-spinner *ngIf="isSaving" slot="start"></ion-spinner>
              <ion-icon *ngIf="!isSaving" name="save-outline" slot="start"></ion-icon>
              {{isSaving ? 'Modification...' : 'Enregistrer les modifications'}}
            </ion-button>

            <ion-button 
              expand="block" 
              color="medium"
              (click)="annuler()"
              [disabled]="isSaving">
              <ion-icon name="close-outline" slot="start"></ion-icon>
              Annuler
            </ion-button>

            <ion-button 
              expand="block" 
              color="secondary"
              (click)="retourStock()"
              [disabled]="isSaving">
              <ion-icon name="list-outline" slot="start"></ion-icon>
              Retour au stock
            </ion-button>
          </div>
        </form>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>